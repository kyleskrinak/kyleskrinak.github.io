---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Socials from "@/components/Socials.astro";
import LinkButton from "@/components/LinkButton.astro";
import Card from "@/components/Card.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import { linkWithBase } from "@/utils/linkWithBase";
import IconRss from "@/assets/icons/IconRss.svg";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
import { SITE } from "@/config";
import { SOCIALS } from "@/constants";

const posts = await getCollection("blog");

const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);
---

<Layout>
  <Header />
  <main id="main-content" data-layout="index" class="app-layout">
    <section id="hero" class:list={["pt-8 pb-6", "border-b border-border"]}>
      <a
        target="_blank"
        href={linkWithBase("/rss.xml")}
        class="inline-block"
        aria-label="rss feed"
        title="RSS Feed"
      >
        <IconRss
          width={20}
          height={20}
          class="scale-125 stroke-accent stroke-3 rtl:-rotate-90"
        />
        <span class="sr-only">RSS Feed</span>
      </a>

      <p>
        Hello and thanks for stopping by. Despite being a full-on Drupal fan, I <LinkButton
          class="underline decoration-dashed underline-offset-4 hover:text-accent"
          href={linkWithBase("/blog/2016-10-31-first-blog-post/")}
        >
          started this blog in 2016
        </LinkButton> as an exercise in using <LinkButton
          class="underline decoration-dashed underline-offset-4 hover:text-accent"
          href="https://jekyllrb.com/"
        >
          Jekyll
        </LinkButton>, a static website generator and with the <LinkButton
          class="underline decoration-dashed underline-offset-4 hover:text-accent"
          href="https://mmistakes.github.io/minimal-mistakes/"
        >
          Minimal Mistakes
        </LinkButton> theme. By doing so, I discovered I could easily create a feature-rich web blog only serving HTML resources. No PHP, Python, or the like, running on the server.
      </p>
      <p class="mt-2">
        As for my interests; by day, I manage web development and system administration. Otherwise, I am a fan of low-carb eating, as the pages of this blog reflect. I use these topics as excuses for writing on my blog as an excuse to write in Markdown and NeoVim. And write.
      </p>
      <p class="mt-2">
        Currently, I am the Senior Manager of the Digital Experience Platform Team for <LinkButton
          class="underline decoration-dashed underline-offset-4 hover:text-accent"
          href="https://www.gilead.com/"
        >
          Gilead Sciences
        </LinkButton>. Our team is responsible for the reliable hosting and management of Gilead's websites. Our main Content Management System is Sitecore and Azure and we also support PHP and static websites on Amazon Web Services.
      </p>
      {
        // only display if at least one social link is enabled
        SOCIALS.length > 0 && (
          <div class="mt-4 flex max-sm:flex-col sm:items-center">
            <div class="me-2 mb-1 whitespace-nowrap sm:mb-0">Social Links:</div>
            <Socials />
          </div>
        )
      }
    </section>

    {
      featuredPosts.length > 0 && (
        <section
          id="featured"
          class:list={[
            "pt-12 pb-6",
            { "border-b border-border": recentPosts.length > 0 },
          ]}
        >
          <h2 class="text-2xl font-semibold tracking-wide">Featured</h2>
          <ul>
            {featuredPosts.map(data => (
              <Card variant="h3" {...data} />
            ))}
          </ul>
        </section>
      )
    }

    {
      recentPosts.length > 0 && (
        <section id="recent-posts" class="pt-12 pb-6">
          <h2 class="text-2xl font-semibold tracking-wide">Recent Posts</h2>
          <ul>
            {recentPosts.map(
              (data, index) =>
                index < SITE.postPerIndex && <Card variant="h3" {...data} />
            )}
          </ul>
        </section>
      )
    }

    <div class="my-8 text-center">
      <LinkButton href={linkWithBase("/posts/")}>
        All Posts
        <IconArrowRight class="inline-block rtl:-rotate-180" />
      </LinkButton>
    </div>
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>
