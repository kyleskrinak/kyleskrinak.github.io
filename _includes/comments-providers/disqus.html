{% if site.comments.disqus.shortname %}
<div id="disqus_thread"></div>

<script>
  var disqus_config = function () {
    this.page.url = "{{ page.url | absolute_url }}";
    this.page.identifier = "{{ page.id }}";
  };

  (function () {
    var d = document, s = d.createElement('script');
    s.src = 'https://{{ site.comments.disqus.shortname }}.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    s.async = true;
    s.onerror = function () {
      var fb = document.getElementById('disqus-fallback');
      if (fb) fb.hidden = false;
    };
    (d.head || d.body).appendChild(s);
  })();
</script>

<p id="disqus-fallback" hidden>
  Comments load from Disqus and might be blocked by a privacy tool.
  You can
  <a href="https://{{ site.comments.disqus.shortname }}.disqus.com/?url={{ page.url | absolute_url }}"
     rel="nofollow noopener" target="_blank">
    open the discussion on Disqus
  </a>
  or permit <code>{{ site.comments.disqus.shortname }}.disqus.com</code> for this site.
</p>

<script>
  // Reveal fallback if the thread container stays empty (blocked or failed)
  setTimeout(function () {
    var thread = document.getElementById('disqus_thread');
    var fb = document.getElementById('disqus-fallback');
    if (fb && thread && thread.children.length === 0) {
      fb.hidden = false;
    }
  }, 2500);
</script>

<noscript>
  Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
{% endif %}